#' autotest
#'
#' Automatically test inputs to functions specified in a 'yaml' template.
#'
#' @param yaml A 'yaml' template as a character vector, either hand-coded or
#' potentially loaded via \link{readLines} function or similar. Should generally
#' be left at default of 'NULL', with template specified by 'filename'
#' parameter.
#' @param filename Name (potentially including path) of file containing 'yaml'
#' template. See \link{at_yaml_template} for details of template. Default uses
#' template generated by that function, and held in local './tests' directory.
#' @param quiet If 'FALSE', provide printed output on screen.
#' @return Nothing
#' @export
autotest <- function (yaml = NULL, filename = NULL, quiet = FALSE) {

    res <- parse_yaml_template (yaml = yaml, filename = filename)

    if (!quiet)
        message (cli::col_green (cli::symbol$star, " Testing functions:"))

    for (i in seq (res$parameters)) {
        this_fn <- names (res$parameters) [i]
        message ("\n", cli::rule (cli::col_green (paste0 ("Testing ", this_fn)),
                                  line_col = "green"))

        params <- get_params (res, i, this_fn)
        params <- params [which (params != "NULL")]
        classes <- res$classes [[i]]

        chk1 <- autotest_rectangular (params, this_fn, classes, quiet)
        chk2 <- autotest_vector (params, this_fn, classes, quiet)
        chk3 <- autotest_single (res$package, params, this_fn, quiet)
        chk4 <- autotest_return (res$package, params, this_fn)

        if (chk1 && chk2 && chk4)
            message (cli::col_green (cli::symbol$tick, " ", this_fn))
        else
            message (cli::col_red (cli::symbol$cross), " ", cli::col_yellow (this_fn))
    }
}
