<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>How to use autotest • autotest</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="How to use autotest">
<meta property="og:description" content="autotest">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">autotest</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.2.077</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/autotest.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/autotest-control.html">Control of tests</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ropensci-review-tools/autotest/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="autotest_files/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="autotest_files/htmlwidgets-1.5.3/htmlwidgets.js"></script><script src="autotest_files/jquery-3.5.1/jquery.min.js"></script><link href="autotest_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="autotest_files/datatables-binding-0.18/datatables.js"></script><link href="autotest_files/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="autotest_files/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="autotest_files/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><link href="autotest_files/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="autotest_files/crosstalk-1.1.1/js/crosstalk.min.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>How to use autotest</h1>
                        <h4 data-toc-skip class="author">Mark Padgham</h4>
            
            <h4 data-toc-skip class="date">2021-06-16</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci-review-tools/autotest/blob/master/vignettes/autotest.Rmd" class="external-link"><code>vignettes/autotest.Rmd</code></a></small>
      <div class="hidden name"><code>autotest.Rmd</code></div>

    </div>

    
    
<p>This vignette demonstrates the easiest way to use <code>autotest</code>, which is to apply it continuously through the entire process of package development. The best way to understand the process is to obtain a local copy of the vignette itself from <a href="https://github.com/ropensci-review-tools/autotest/blob/master/vignettes/autotest.Rmd" class="external-link">this link</a>, and step through the code. We begin by constructing a simple package in the local <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/tempfile.html" class="external-link"><code>tempdir()</code></a>.</p>
<details closed><p><summary><span title="Click to Expand"> Package Construction </span> </summary></p>
<p>To create a package in one simple line, we use <a href="https://usethis.r-lib.org/reference/create_package.html" class="external-link"><code>usethis::create_package()</code></a>, and name our package <code>"demo"</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span> <span class="op">(</span><span class="op">)</span>, <span class="st">"demo"</span><span class="op">)</span>
<span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/create_package.html" class="external-link">create_package</a></span> <span class="op">(</span><span class="va">path</span>, check_name <span class="op">=</span> <span class="cn">FALSE</span>, open <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; ✔ Creating '/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/Rtmp67X51a/demo/'</span>
<span class="co">#&gt; ✔ Setting active project to '/private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/Rtmp67X51a/demo'</span>
<span class="co">#&gt; ✔ Creating 'R/'</span>
<span class="co">#&gt; ✔ Writing 'DESCRIPTION'</span>
<span class="co">#&gt; Package: demo</span>
<span class="co">#&gt; Title: What the Package Does (One Line, Title Case)</span>
<span class="co">#&gt; Version: 0.0.0.9000</span>
<span class="co">#&gt; Authors@R (parsed):</span>
<span class="co">#&gt;     * First Last &lt;first.last@example.com&gt; [aut, cre] (YOUR-ORCID-ID)</span>
<span class="co">#&gt; Description: What the package does (one paragraph).</span>
<span class="co">#&gt; License: `use_mit_license()`, `use_gpl3_license()` or friends to pick a</span>
<span class="co">#&gt;     license</span>
<span class="co">#&gt; Encoding: UTF-8</span>
<span class="co">#&gt; LazyData: true</span>
<span class="co">#&gt; Roxygen: list(markdown = TRUE)</span>
<span class="co">#&gt; RoxygenNote: 7.1.1</span>
<span class="co">#&gt; ✔ Writing 'NAMESPACE'</span>
<span class="co">#&gt; ✔ Setting active project to '&lt;no active project&gt;'</span></code></pre></div>
<p>We also set our license to GPL3, to avoid needing an extra “License” file.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">wd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span> <span class="op">(</span><span class="va">path</span><span class="op">)</span>
<span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/licenses.html" class="external-link">use_gpl3_license</a></span> <span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; ✔ Setting active project to '/private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/Rtmp67X51a/demo'</span>
<span class="co">#&gt; ✔ Setting License field in DESCRIPTION to 'GPL (&gt;= 3)'</span>
<span class="co">#&gt; ✔ Writing 'LICENSE.md'</span>
<span class="co">#&gt; ✔ Adding '^LICENSE\\.md$' to '.Rbuildignore'</span>
<span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span> <span class="op">(</span><span class="va">wd</span><span class="op">)</span></code></pre></div>
<p>The structure looks like this:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="http://fs.r-lib.org/reference/dir_tree.html" class="external-link">dir_tree</a></span> <span class="op">(</span><span class="va">path</span><span class="op">)</span>
<span class="co">#&gt; /var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T//Rtmp67X51a/demo</span>
<span class="co">#&gt; ├── DESCRIPTION</span>
<span class="co">#&gt; ├── LICENSE.md</span>
<span class="co">#&gt; ├── NAMESPACE</span>
<span class="co">#&gt; └── R</span></code></pre></div>
</details><p><br></p>
<p>Having constructed a minimal package structure, we can then insert some code in the <code>R/</code> directory, including initial <a href="https://roxygen2.r-lib.org" class="external-link"><code>roxygen2</code></a> documentation lines, and use the <a href="https://roxygen2.r-lib.org/reference/roxygenize.html" class="external-link"><code>roxygenise()</code> function</a> to create the corresponding <code>man</code> files.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">code</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="st">"#' my_function"</span>,
           <span class="st">"#'"</span>,
           <span class="st">"#' @param x An input"</span>,
           <span class="st">"#' @return Something else"</span>,
           <span class="st">"#' @export"</span>,
           <span class="st">"my_function &lt;- function (x) {"</span>,
           <span class="st">"  return (x + 1)"</span>,
           <span class="st">"}"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span> <span class="op">(</span><span class="va">code</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span> <span class="op">(</span><span class="va">path</span>, <span class="st">"R"</span>, <span class="st">"myfn.R"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">roxygen2</span><span class="fu">::</span><span class="fu"><a href="https://roxygen2.r-lib.org/reference/roxygenize.html" class="external-link">roxygenise</a></span> <span class="op">(</span><span class="va">path</span><span class="op">)</span>
<span class="co">#&gt; ℹ Loading demo</span>
<span class="co">#&gt; Writing NAMESPACE</span>
<span class="co">#&gt; Writing my_function.Rd</span></code></pre></div>
<p>Our package now looks like this:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="http://fs.r-lib.org/reference/dir_tree.html" class="external-link">dir_tree</a></span> <span class="op">(</span><span class="va">path</span><span class="op">)</span>
<span class="co">#&gt; /var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T//Rtmp67X51a/demo</span>
<span class="co">#&gt; ├── DESCRIPTION</span>
<span class="co">#&gt; ├── LICENSE.md</span>
<span class="co">#&gt; ├── NAMESPACE</span>
<span class="co">#&gt; ├── R</span>
<span class="co">#&gt; │   └── myfn.R</span>
<span class="co">#&gt; └── man</span>
<span class="co">#&gt;     └── my_function.Rd</span></code></pre></div>
<p>We can already apply <code>autotest</code> to that package to see what happens, first ensuring that we’ve loaded the package ready to use.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span> <span class="op">(</span><span class="va"><a href="https://github.com/ropensci-review-tools/autotest" class="external-link">autotest</a></span><span class="op">)</span>
<span class="va">x0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/autotest_package.html">autotest_package</a></span> <span class="op">(</span><span class="va">path</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; ℹ Loading autotest
#&gt; 
#&gt; ── autotesting demo ──
#&gt; </code></pre>
<p>We use the <a href="https://rstudio.github.io/DT" class="external-link"><code>DT</code> package</a> to display the results here.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span> <span class="op">(</span><span class="va">x0</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span>dom <span class="op">=</span> <span class="st">"t"</span><span class="op">)</span><span class="op">)</span> <span class="co"># display table only</span></code></pre></div>
<div id="htmlwidget-ee9216600a64b51e12cc" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-ee9216600a64b51e12cc">{"x":{"filter":"none","data":[["1"],["warning"],["fn_without_example"],["my_function"],[null],[null],["Identify functions without documented examples"],["This function has no documented example"],[true],[null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>type<\/th>\n      <th>test_name<\/th>\n      <th>fn_name<\/th>\n      <th>parameter<\/th>\n      <th>parameter_type<\/th>\n      <th>operation<\/th>\n      <th>content<\/th>\n      <th>test<\/th>\n      <th>yaml_hash<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}]}},"evals":[],"jsHooks":[]}</script><div id="adding-examples-to-our-code" class="section level2">
<h2 class="hasAnchor">
<a href="#adding-examples-to-our-code" class="anchor" aria-hidden="true"></a>Adding examples to our code</h2>
<p>That tells us straight away that we need to add an example to our function documentation. So let’s do that by inserting extra lines into the <code>code</code> defined above, and see what happens.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">code</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="va">code</span> <span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>,
           <span class="st">"#' @examples"</span>,
           <span class="st">"#' y &lt;- my_function (x = 1)"</span>,
           <span class="va">code</span> <span class="op">[</span><span class="fl">5</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span> <span class="op">(</span><span class="va">code</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span> <span class="op">(</span><span class="va">code</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span> <span class="op">(</span><span class="va">path</span>, <span class="st">"R"</span>, <span class="st">"myfn.R"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">roxygen2</span><span class="fu">::</span><span class="fu"><a href="https://roxygen2.r-lib.org/reference/roxygenize.html" class="external-link">roxygenise</a></span> <span class="op">(</span><span class="va">path</span><span class="op">)</span>
<span class="co">#&gt; ℹ Loading demo</span>
<span class="co">#&gt; Writing NAMESPACE</span>
<span class="co">#&gt; Writing NAMESPACE</span>
<span class="co">#&gt; Writing my_function.Rd</span>
<span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/autotest_package.html">autotest_package</a></span> <span class="op">(</span><span class="va">path</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── autotesting demo ──</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ✔ [1 / 1]: my_function</span>
<span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span> <span class="op">(</span><span class="va">x1</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span>dom <span class="op">=</span> <span class="st">"t"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-23f04d939225a644bb0d" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-23f04d939225a644bb0d">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9"],["dummy","dummy","dummy","dummy","dummy","dummy","dummy","dummy","dummy"],["double_is_int","trivial_noise","single_par_as_length_2","return_successful","return_val_described","return_desc_includes_class","return_class_matches_desc","par_is_documented","par_matches_docs"],["my_function","my_function","my_function","my_function","my_function","my_function","my_function","my_function","my_function"],["x","x","x","(return object)","(return object)","(return object)","(return object)","x","x"],["numeric","numeric","single numeric","(return object)","(return object)","(return object)","(return object)",null,null],["Check whether double is only used as int","Add trivial noise to numeric parameter","Length 2 vector for length 1 parameter","Check that function successfully returns an object","Check that description has return value","Check whether description of return value specifies class","Compare class of return value with description","Check that parameter is documented","Check that documentation matches class of input parameter"],["int parameters should have terminal 'L'","(Should yield same result)","Should trigger message, warning, or error",null,null,null,null,null,null],[true,true,true,true,true,true,true,true,true],["e94ce4a6aba5cf941c46a81080e1aad8","e94ce4a6aba5cf941c46a81080e1aad8","e94ce4a6aba5cf941c46a81080e1aad8","e94ce4a6aba5cf941c46a81080e1aad8","e94ce4a6aba5cf941c46a81080e1aad8","e94ce4a6aba5cf941c46a81080e1aad8","e94ce4a6aba5cf941c46a81080e1aad8","e94ce4a6aba5cf941c46a81080e1aad8","e94ce4a6aba5cf941c46a81080e1aad8"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>type<\/th>\n      <th>test_name<\/th>\n      <th>fn_name<\/th>\n      <th>parameter<\/th>\n      <th>parameter_type<\/th>\n      <th>operation<\/th>\n      <th>content<\/th>\n      <th>test<\/th>\n      <th>yaml_hash<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}]}},"evals":[],"jsHooks":[]}</script><p>The first thing to notice is the first column, which has <code>test_type = "dummy"</code> for all rows. The <a href="https://ropensci-review-tools.github.io/autotest/reference/autotest_package.html"><code>autotest_package()</code> function</a> has a parameter <code>test</code> with a default value of <code>FALSE</code>, so that the default call demonstrated above does not actually implement the tests, rather it returns an object listing all tests that would be performed with actually doing so. Applying the tests by setting <code>test = TRUE</code> gives the following result.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/autotest_package.html">autotest_package</a></span> <span class="op">(</span><span class="va">path</span>, test <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; ── autotesting demo ──</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ✔ [1 / 1]: my_function</span>
<span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span> <span class="op">(</span><span class="va">x2</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span>dom <span class="op">=</span> <span class="st">"t"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-a640593215862f0995da" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a640593215862f0995da">{"x":{"filter":"none","data":[["1","2"],["diagnostic","diagnostic"],["double_is_int","single_par_as_length_2"],["my_function","my_function"],["x","x"],["numeric","single numeric"],["Check whether double is only used as int","Length 2 vector for length 1 parameter"],["Parameter [x] is not specified as integer, yet only used as such; please use '1L' for integer, or 1.0 for non-integer values.","Parameter [x] of function [my_function] is assumed to be a single numeric, but responds to vectors of length &gt; 1"],[true,true],["e94ce4a6aba5cf941c46a81080e1aad8","e94ce4a6aba5cf941c46a81080e1aad8"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>type<\/th>\n      <th>test_name<\/th>\n      <th>fn_name<\/th>\n      <th>parameter<\/th>\n      <th>parameter_type<\/th>\n      <th>operation<\/th>\n      <th>content<\/th>\n      <th>test<\/th>\n      <th>yaml_hash<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}]}},"evals":[],"jsHooks":[]}</script><p>Of the 9 tests which were performed, only 2 yielded unexpected behaviour. The first indicates that the parameter <code>x</code> has only been used as an integer, yet was not specified as such. The second states that the parameter <code>x</code> is “assumed to be a single numeric”. <code>autotest</code> does its best to figure out what types of inputs are expected for each parameter, and with the example only demonstrating <code>x = 1</code>, assumes that <code>x</code> is always expected to be a single value. We can resolve the first of these by replacing <code>x = 1</code> with <code>x = 1.</code> to clearly indicate that it is not an integer, and the second by asserting that <code>length(x) == 1</code>, as follows:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">code</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="st">"#' my_function"</span>,
           <span class="st">"#'"</span>,
           <span class="st">"#' @param x An input"</span>,
           <span class="st">"#' @return Something else"</span>,
           <span class="st">"#' @examples"</span>,
           <span class="st">"#' y &lt;- my_function (x = 1.)"</span>,
           <span class="st">"#' @export"</span>,
           <span class="st">"my_function &lt;- function (x) {"</span>,
           <span class="st">"  if (length(x) &gt; 1) {"</span>,
           <span class="st">"    warning(\"only the first value of x will be used\")"</span>,
           <span class="st">"    x &lt;- x [1]"</span>,
           <span class="st">"  }"</span>,
           <span class="st">"  return (x + 1)"</span>,
           <span class="st">"}"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span> <span class="op">(</span><span class="va">code</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span> <span class="op">(</span><span class="va">path</span>, <span class="st">"R"</span>, <span class="st">"myfn.R"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">roxygen2</span><span class="fu">::</span><span class="fu"><a href="https://roxygen2.r-lib.org/reference/roxygenize.html" class="external-link">roxygenise</a></span> <span class="op">(</span><span class="va">path</span><span class="op">)</span>
<span class="co">#&gt; ℹ Loading demo</span>
<span class="co">#&gt; Writing NAMESPACE</span>
<span class="co">#&gt; Writing NAMESPACE</span>
<span class="co">#&gt; Writing my_function.Rd</span></code></pre></div>
<p>This is then sufficient to pass all <code>autotest</code> tests and so return <code>NULL</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/autotest_package.html">autotest_package</a></span> <span class="op">(</span><span class="va">path</span>, test <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── autotesting demo ──</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ✔ [1 / 1]: my_function</span>
<span class="co">#&gt; NULL</span></code></pre></div>
</div>
<div id="integer-input" class="section level2">
<h2 class="hasAnchor">
<a href="#integer-input" class="anchor" aria-hidden="true"></a>Integer input</h2>
<p>Note that <code>autotest</code> distinguishes integer and non-integer types by their <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/mode.html" class="external-link"><code>storage.mode</code></a> of <code>"integer"</code> and <code>"double"</code>, and not by their respective classes of <code>"integer"</code> and <code>"numeric"</code>, because <code>"numeric"</code> is ambiguous in R, and <code>is.numeric(1L)</code> is <code>TRUE</code>, even though <code>storage.mode(1L)</code> is <code>"integer"</code>, and not <code>"numeric"</code>. Replacing <code>x = 1</code> with <code>x = 1.</code> explicitly identifies that parameter as a <code>"double"</code> parameter, and allowed the preceding tests to pass. Note what happens if we instead specify that parameter as an integer (<code>x = 1L</code>).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">code</span> <span class="op">[</span><span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span> <span class="op">(</span><span class="st">"1\\."</span>, <span class="st">"1L"</span>, <span class="va">code</span> <span class="op">[</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span> <span class="op">(</span><span class="va">code</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span> <span class="op">(</span><span class="va">path</span>, <span class="st">"R"</span>, <span class="st">"myfn.R"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">roxygen2</span><span class="fu">::</span><span class="fu"><a href="https://roxygen2.r-lib.org/reference/roxygenize.html" class="external-link">roxygenise</a></span> <span class="op">(</span><span class="va">path</span><span class="op">)</span>
<span class="co">#&gt; ℹ Loading demo</span>
<span class="co">#&gt; Writing NAMESPACE</span>
<span class="co">#&gt; Writing NAMESPACE</span>
<span class="co">#&gt; Writing my_function.Rd</span>
<span class="va">x3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/autotest_package.html">autotest_package</a></span> <span class="op">(</span><span class="va">path</span>, test <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── autotesting demo ──</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ✔ [1 / 1]: my_function</span>
<span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span> <span class="op">(</span><span class="va">x3</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span>dom <span class="op">=</span> <span class="st">"t"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-29ea1c8a2d8e836d866d" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-29ea1c8a2d8e836d866d">{"x":{"filter":"none","data":[["1"],["diagnostic"],["int_range"],["my_function"],["x"],["single integer"],["Ascertain permissible range"],["Parameter [x] permits unrestricted integer inputs,  yet does not document this; please add 'unrestricted' to parameter description."],[true],["81d81c1de82682dae1a2c606d7dc6516"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>type<\/th>\n      <th>test_name<\/th>\n      <th>fn_name<\/th>\n      <th>parameter<\/th>\n      <th>parameter_type<\/th>\n      <th>operation<\/th>\n      <th>content<\/th>\n      <th>test<\/th>\n      <th>yaml_hash<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}]}},"evals":[],"jsHooks":[]}</script><p>That then generates two additional messages, the second of which reflects an expectation that parameters assumed to be integer-valued should assert that, for example by converting with <code><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer()</a></code>. The following suffices to remove that message.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">code</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="va">code</span> <span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span>,
           <span class="st">"  if (is.numeric (x))"</span>,
           <span class="st">"    x &lt;- as.integer (x)"</span>,
           <span class="va">code</span> <span class="op">[</span><span class="fl">13</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span> <span class="op">(</span><span class="va">code</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p>The remaining message concerns integer ranges. For any parameters which <code>autotest</code> identifies as single integers, routines will try a full range of values between <code>+/- .Machine$integer.max</code>, to ensure that all values are appropriately handled. Many routines may sensibly allow unrestricted ranges, while many others may not implement explicit control over permissible ranges, yet may error on, for example, unexpectedly large positive or negative values. The content of the diagnostic message indicates one way to resolve this issue, which is simply by describing the input as <code>"unrestricted"</code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">code</span> <span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span> <span class="op">(</span><span class="st">"An input"</span>, <span class="st">"An unrestricted input"</span>, <span class="va">code</span> <span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span> <span class="op">(</span><span class="va">code</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span> <span class="op">(</span><span class="va">path</span>, <span class="st">"R"</span>, <span class="st">"myfn.R"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">roxygen2</span><span class="fu">::</span><span class="fu"><a href="https://roxygen2.r-lib.org/reference/roxygenize.html" class="external-link">roxygenise</a></span> <span class="op">(</span><span class="va">path</span><span class="op">)</span>
<span class="co">#&gt; ℹ Loading demo</span>
<span class="co">#&gt; Writing NAMESPACE</span>
<span class="co">#&gt; Writing NAMESPACE</span>
<span class="co">#&gt; Writing my_function.Rd</span>
<span class="fu"><a href="../reference/autotest_package.html">autotest_package</a></span> <span class="op">(</span><span class="va">path</span>, test <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── autotesting demo ──</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ✔ [1 / 1]: my_function</span>
<span class="co">#&gt; NULL</span></code></pre></div>
<p>An alternative, and frequently better way, is to ensure and document specific control over permissible ranges, as in the following revision of our function.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">code</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="st">"#' my_function"</span>,
           <span class="st">"#'"</span>,
           <span class="st">"#' @param x An input between 0 and 10"</span>,
           <span class="st">"#' @return Something else"</span>,
           <span class="st">"#' @examples"</span>,
           <span class="st">"#' y &lt;- my_function (x = 1L)"</span>,
           <span class="st">"#' @export"</span>,
           <span class="st">"my_function &lt;- function (x) {"</span>,
           <span class="st">"  if (length(x) &gt; 1) {"</span>,
           <span class="st">"    warning(\"only the first value of x will be used\")"</span>,
           <span class="st">"    x &lt;- x [1]"</span>,
           <span class="st">"  }"</span>,
           <span class="st">"  if (is.numeric (x))"</span>,
           <span class="st">"    x &lt;- as.integer (x)"</span>,
           <span class="st">"  if (x &lt; 0 | x &gt; 10) {"</span>,
           <span class="st">"    stop (\"x must be between 0 and 10\")"</span>,
           <span class="st">"  }"</span>,
           <span class="st">"  return (x + 1L)"</span>,
           <span class="st">"}"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span> <span class="op">(</span><span class="va">code</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span> <span class="op">(</span><span class="va">path</span>, <span class="st">"R"</span>, <span class="st">"myfn.R"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">roxygen2</span><span class="fu">::</span><span class="fu"><a href="https://roxygen2.r-lib.org/reference/roxygenize.html" class="external-link">roxygenise</a></span> <span class="op">(</span><span class="va">path</span><span class="op">)</span>
<span class="co">#&gt; ℹ Loading demo</span>
<span class="co">#&gt; Writing NAMESPACE</span>
<span class="co">#&gt; Writing NAMESPACE</span>
<span class="co">#&gt; Writing my_function.Rd</span>
<span class="fu"><a href="../reference/autotest_package.html">autotest_package</a></span> <span class="op">(</span><span class="va">path</span>, test <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── autotesting demo ──</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ✔ [1 / 1]: my_function</span>
<span class="co">#&gt; NULL</span></code></pre></div>
</div>
<div id="vector-input" class="section level2">
<h2 class="hasAnchor">
<a href="#vector-input" class="anchor" aria-hidden="true"></a>Vector input</h2>
<p>The initial test results above suggested that the input was <em>assumed</em> to be of length one. Let us now revert our function to its original format which accepted vectors of length &gt; 1, and include an example demonstrating such input.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">code</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="st">"#' my_function"</span>,
           <span class="st">"#'"</span>,
           <span class="st">"#' @param x An input"</span>,
           <span class="st">"#' @return Something else"</span>,
           <span class="st">"#' @examples"</span>,
           <span class="st">"#' y &lt;- my_function (x = 1)"</span>,
           <span class="st">"#' y &lt;- my_function (x = 1:2)"</span>,
           <span class="st">"#' @export"</span>,
           <span class="st">"my_function &lt;- function (x) {"</span>,
           <span class="st">"  if (is.numeric (x)) {"</span>,
           <span class="st">"    x &lt;- as.integer (x)"</span>,
           <span class="st">"  }"</span>,
           <span class="st">"  return (x + 1L)"</span>,
           <span class="st">"}"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span> <span class="op">(</span><span class="va">code</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span> <span class="op">(</span><span class="va">path</span>, <span class="st">"R"</span>, <span class="st">"myfn.R"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">roxygen2</span><span class="fu">::</span><span class="fu"><a href="https://roxygen2.r-lib.org/reference/roxygenize.html" class="external-link">roxygenise</a></span> <span class="op">(</span><span class="va">path</span><span class="op">)</span>
<span class="co">#&gt; ℹ Loading demo</span>
<span class="co">#&gt; Writing NAMESPACE</span>
<span class="co">#&gt; Writing NAMESPACE</span>
<span class="co">#&gt; Writing my_function.Rd</span></code></pre></div>
<p>Note that the first example no longer has <code>x = 1L</code>. This is because vector inputs are identified as <code>integer</code> by examining all individual values, and presuming <code>integer</code> representations for any parameters for which all values are whole numbers, regardless of <code>storage.mode</code>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/autotest_package.html">autotest_package</a></span> <span class="op">(</span><span class="va">path</span>, test <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── autotesting demo ──</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ✔ [1 / 1]: my_function</span>
<span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span> <span class="op">(</span><span class="va">x4</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span>dom <span class="op">=</span> <span class="st">"t"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-427c2e0809e5bd510222" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-427c2e0809e5bd510222">{"x":{"filter":"none","data":[["1"],["diagnostic"],["vector_to_list_col"],["my_function"],["x"],["vector"],["Convert vector input to list-columns"],["Function [my_function] errors on list-columns when submitted as x Error message: non-numeric argument to binary operator"],[true],["042acd01ef567721afed2095beb30297"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>type<\/th>\n      <th>test_name<\/th>\n      <th>fn_name<\/th>\n      <th>parameter<\/th>\n      <th>parameter_type<\/th>\n      <th>operation<\/th>\n      <th>content<\/th>\n      <th>test<\/th>\n      <th>yaml_hash<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}]}},"evals":[],"jsHooks":[]}</script><div id="list-column-conversion" class="section level3">
<h3 class="hasAnchor">
<a href="#list-column-conversion" class="anchor" aria-hidden="true"></a>List-column conversion</h3>
<p>The above result reflects one of the standard tests, which is to determine whether list-column formats are appropriately processed. List-columns commonly arise when using (either directly or indirectly), the <a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link"><code>tidyr::nest()</code> function</a>, or equivalently in base R with the <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/AsIs.html" class="external-link"><code>I</code> or <code>AsIs</code> function</a>. They look like this:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span> <span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, y <span class="op">=</span> <span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>
<span class="va">dat</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span> <span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="co"># base R</span>
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span> <span class="op">(</span><span class="va">dat</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span> <span class="op">(</span><span class="va">dat</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 3 x 2</span>
<span class="co">#&gt;   x         y               </span>
<span class="co">#&gt;   &lt;I&lt;list&gt;&gt; &lt;list&gt;          </span>
<span class="co">#&gt; 1 &lt;int [1]&gt; &lt;tibble [1 × 1]&gt;</span>
<span class="co">#&gt; 2 &lt;int [1]&gt; &lt;tibble [1 × 1]&gt;</span>
<span class="co">#&gt; 3 &lt;int [1]&gt; &lt;tibble [1 × 1]&gt;</span></code></pre></div>
<p>The use of packages like <a href="https://tidyr.tidyverse.org" class="external-link"><code>tidyr</code></a> and <a href="https://purrr.tidyverse.org" class="external-link"><code>purrr</code></a> quite often leads to <a href="https://tibble.tidyverse.org" class="external-link"><code>tibble</code></a>-class inputs which contain list-columns. Any functions which fail to identify and appropriately respond to such inputs may generate unexpected errors, and this <code>autotest</code> is intended to enforce appropriate handling of these kinds of inputs. The following lines demonstrate the kinds of results that can arise without such checks.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m</span> <span class="op">&lt;-</span> <span class="va">mtcars</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span> <span class="op">(</span><span class="va">m</span>, n <span class="op">=</span> <span class="fl">2L</span><span class="op">)</span>
<span class="co">#&gt;               mpg cyl disp  hp drat    wt  qsec vs am gear carb</span>
<span class="co">#&gt; Mazda RX4      21   6  160 110  3.9 2.620 16.46  0  1    4    4</span>
<span class="co">#&gt; Mazda RX4 Wag  21   6  160 110  3.9 2.875 17.02  0  1    4    4</span>
<span class="va">m</span><span class="op">$</span><span class="va">mpg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span> <span class="op">(</span><span class="va">m</span><span class="op">$</span><span class="va">mpg</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span> <span class="op">(</span><span class="va">m</span>, n <span class="op">=</span> <span class="fl">2L</span><span class="op">)</span> <span class="co"># looks exaxtly the same</span>
<span class="co">#&gt;               mpg cyl disp  hp drat    wt  qsec vs am gear carb</span>
<span class="co">#&gt; Mazda RX4      21   6  160 110  3.9 2.620 16.46  0  1    4    4</span>
<span class="co">#&gt; Mazda RX4 Wag  21   6  160 110  3.9 2.875 17.02  0  1    4    4</span>
<span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span> <span class="op">(</span><span class="va">m</span><span class="op">)</span>
<span class="co">#&gt; Error in cor(m): 'x' must be numeric</span></code></pre></div>
<p>In contrast, many functions either assume inputs to be lists, and convert when not, or implicitly <code>unlist</code>. Either way, such functions may respond entirely consistently regardless of the presence of list-columns, like this:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m</span><span class="op">$</span><span class="va">mpg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span> <span class="op">(</span><span class="st">"a"</span>, <span class="va">m</span><span class="op">$</span><span class="va">mpg</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span> <span class="op">(</span><span class="va">m</span><span class="op">$</span><span class="va">mpg</span><span class="op">)</span>
<span class="co">#&gt; [1] "character"</span></code></pre></div>
<p>The list-column <code>autotest</code> is intended to enforce consistent behaviour in response to list-column inputs. One way to identify list-column formats is to check the value of <code>class(unclass(.))</code> of each column. The <code>unclass</code> function is necessary to first remove any additional class attributes, such as <code>I</code> in <code>dat$x</code> above. A modified version of our function which identifies and responds to list-column inputs might look like this:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">code</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="st">"#' my_function"</span>,
           <span class="st">"#'"</span>,
           <span class="st">"#' @param x An input"</span>,
           <span class="st">"#' @return Something else"</span>,
           <span class="st">"#' @examples"</span>,
           <span class="st">"#' y &lt;- my_function (x = 1)"</span>,
           <span class="st">"#' y &lt;- my_function (x = 1:2)"</span>,
           <span class="st">"#' @export"</span>,
           <span class="st">"my_function &lt;- function (x) {"</span>,
           <span class="st">"  if (methods::is (unclass (x), \"list\")) {"</span>,
           <span class="st">"    x &lt;- unlist (x)"</span>,
           <span class="st">"  }"</span>,
           <span class="st">"  if (is.numeric (x)) {"</span>,
           <span class="st">"    x &lt;- as.integer (x)"</span>,
           <span class="st">"  }"</span>,
           <span class="st">"  return (x + 1L)"</span>,
           <span class="st">"}"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span> <span class="op">(</span><span class="va">code</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span> <span class="op">(</span><span class="va">path</span>, <span class="st">"R"</span>, <span class="st">"myfn.R"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">roxygen2</span><span class="fu">::</span><span class="fu"><a href="https://roxygen2.r-lib.org/reference/roxygenize.html" class="external-link">roxygenise</a></span> <span class="op">(</span><span class="va">path</span><span class="op">)</span>
<span class="co">#&gt; ℹ Loading demo</span>
<span class="co">#&gt; Writing NAMESPACE</span>
<span class="co">#&gt; Writing NAMESPACE</span></code></pre></div>
<p>That change once again leads to clean <code>autotest</code> results:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/autotest_package.html">autotest_package</a></span> <span class="op">(</span><span class="va">path</span>, test <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── autotesting demo ──</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ✔ [1 / 1]: my_function</span>
<span class="co">#&gt; NULL</span></code></pre></div>
<p>Of course simply attempting to <code>unlist</code> a complex list-column may be dangerous, and it may be preferable to issue some kind of message or warning, or even either simply remove any list-columns entirely or generate an error. Replacing the above, potentially dangerous, line, <code>x &lt;- unlist (x)</code> with a simple <code>stop("list-columns are not allowed")</code> will also produce clean <code>autotest</code> results.</p>
</div>
</div>
<div id="return-results-and-documentation" class="section level2">
<h2 class="hasAnchor">
<a href="#return-results-and-documentation" class="anchor" aria-hidden="true"></a>Return results and documentation</h2>
<p>Functions which return complicated results, such as objects with specific classes, need to document those class types, and <code>autotest</code> compares return objects with documentation to ensure that this is done. The following code constructs a new function to demonstrate some of the ways <code>autotest</code> inspects return objects, demonstrating a vector input (<code>length(x) &gt; 1</code>) in the example to avoid messages regarding length checks an integer ranges.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">code</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="st">"#' my_function3"</span>,
           <span class="st">"#'"</span>,
           <span class="st">"#' @param x An input"</span>,
           <span class="st">"#' @examples"</span>,
           <span class="st">"#' y &lt;- my_function3 (x = 1:2)"</span>,
           <span class="st">"#' @export"</span>,
           <span class="st">"my_function3 &lt;- function (x) {"</span>,
           <span class="st">"  return (datasets::iris)"</span>,
           <span class="st">"}"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span> <span class="op">(</span><span class="va">code</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span> <span class="op">(</span><span class="va">path</span>, <span class="st">"R"</span>, <span class="st">"myfn3.R"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">roxygen2</span><span class="fu">::</span><span class="fu"><a href="https://roxygen2.r-lib.org/reference/roxygenize.html" class="external-link">roxygenise</a></span> <span class="op">(</span><span class="va">path</span><span class="op">)</span> <span class="co"># need to update docs with seed param</span>
<span class="co">#&gt; ℹ Loading demo</span>
<span class="co">#&gt; Writing NAMESPACE</span>
<span class="co">#&gt; Writing NAMESPACE</span>
<span class="co">#&gt; Writing my_function3.Rd</span>
<span class="va">x5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/autotest_package.html">autotest_package</a></span> <span class="op">(</span><span class="va">path</span>, test <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── autotesting demo ──</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ✔ [1 / 2]: my_function</span>
<span class="co">#&gt; ✔ [2 / 2]: my_function3</span>
<span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span> <span class="op">(</span><span class="va">x5</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span>dom <span class="op">=</span> <span class="st">"t"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-f244bfca6694c939fe8b" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f244bfca6694c939fe8b">{"x":{"filter":"none","data":[["1","2","3"],["diagnostic","diagnostic","diagnostic"],["return_val_described","return_desc_includes_class","return_class_matches_desc"],["my_function3","my_function3","my_function3"],["(return object)","(return object)","(return object)"],["(return object)","(return object)","(return object)"],["Check that description has return value","Check whether description of return value specifies class","Compare class of return value with description"],["Function [my_function3] does not specify a return value.","Function [my_function3] does not describe return value","Function [my_function3] does not describe return value"],[true,true,true],["7d42be5f56567b4d91022b850a9259d3","7d42be5f56567b4d91022b850a9259d3","7d42be5f56567b4d91022b850a9259d3"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>type<\/th>\n      <th>test_name<\/th>\n      <th>fn_name<\/th>\n      <th>parameter<\/th>\n      <th>parameter_type<\/th>\n      <th>operation<\/th>\n      <th>content<\/th>\n      <th>test<\/th>\n      <th>yaml_hash<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}]}},"evals":[],"jsHooks":[]}</script><p>Several new diagnostic messages are then issued regarding the description of the returned value. Let’s insert a description to see the effect.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">code</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="va">code</span> <span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>,
           <span class="st">"#' @return The iris data set as dataframe"</span>,
           <span class="va">code</span> <span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span> <span class="op">(</span><span class="va">code</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span> <span class="op">(</span><span class="va">code</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span> <span class="op">(</span><span class="va">path</span>, <span class="st">"R"</span>, <span class="st">"myfn3.R"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">roxygen2</span><span class="fu">::</span><span class="fu"><a href="https://roxygen2.r-lib.org/reference/roxygenize.html" class="external-link">roxygenise</a></span> <span class="op">(</span><span class="va">path</span><span class="op">)</span> <span class="co"># need to update docs with seed param</span>
<span class="co">#&gt; ℹ Loading demo</span>
<span class="co">#&gt; Writing NAMESPACE</span>
<span class="co">#&gt; Writing NAMESPACE</span>
<span class="co">#&gt; Writing my_function3.Rd</span>
<span class="va">x6</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/autotest_package.html">autotest_package</a></span> <span class="op">(</span><span class="va">path</span>, test <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── autotesting demo ──</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ✔ [1 / 2]: my_function</span>
<span class="co">#&gt; ✔ [2 / 2]: my_function3</span>
<span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span> <span class="op">(</span><span class="va">x6</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span>dom <span class="op">=</span> <span class="st">"t"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-5df3a39eb139f6f2f747" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-5df3a39eb139f6f2f747">{"x":{"filter":"none","data":[["1","2"],["diagnostic","diagnostic"],["return_desc_includes_class","return_class_matches_desc"],["my_function3","my_function3"],["(return object)","(return object)"],["(return object)","(return object)"],["Check whether description of return value specifies class","Compare class of return value with description"],["Function [my_function3] returns a value of class [data.frame], which differs from the value provided in the description","Function returns an object of class [data.frame] yet documentation describes class of value as [dataframe]"],[true,true],["7d42be5f56567b4d91022b850a9259d3","7d42be5f56567b4d91022b850a9259d3"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>type<\/th>\n      <th>test_name<\/th>\n      <th>fn_name<\/th>\n      <th>parameter<\/th>\n      <th>parameter_type<\/th>\n      <th>operation<\/th>\n      <th>content<\/th>\n      <th>test<\/th>\n      <th>yaml_hash<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}]}},"evals":[],"jsHooks":[]}</script><p>That result still contains a couple of diagnostic messages, but it is now pretty clear what we need to do, which is to be precise with our specification of the class of return object. The following then suffices to once again generate clean <code>autotest</code> results.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">code</span> <span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"#' @return The iris data set as data.frame"</span>
<span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span> <span class="op">(</span><span class="va">code</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span> <span class="op">(</span><span class="va">path</span>, <span class="st">"R"</span>, <span class="st">"myfn3.R"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">roxygen2</span><span class="fu">::</span><span class="fu"><a href="https://roxygen2.r-lib.org/reference/roxygenize.html" class="external-link">roxygenise</a></span> <span class="op">(</span><span class="va">path</span><span class="op">)</span> <span class="co"># need to update docs with seed param</span>
<span class="co">#&gt; ℹ Loading demo</span>
<span class="co">#&gt; Writing NAMESPACE</span>
<span class="co">#&gt; Writing NAMESPACE</span>
<span class="co">#&gt; Writing my_function3.Rd</span>
<span class="fu"><a href="../reference/autotest_package.html">autotest_package</a></span> <span class="op">(</span><span class="va">path</span>, test <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── autotesting demo ──</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ✔ [1 / 2]: my_function</span>
<span class="co">#&gt; ✔ [2 / 2]: my_function3</span>
<span class="co">#&gt; NULL</span></code></pre></div>
<div id="documentation-of-input-parameters" class="section level3">
<h3 class="hasAnchor">
<a href="#documentation-of-input-parameters" class="anchor" aria-hidden="true"></a>Documentation of input parameters</h3>
<p>Similar checks are performed on the documentation of input parameters, as demonstrated by the following modified version of the preceding function.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">code</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="st">"#' my_function3"</span>,
           <span class="st">"#'"</span>,
           <span class="st">"#' @param x An input"</span>,
           <span class="st">"#' @return The iris data set as data.frame"</span>,
           <span class="st">"#' @examples"</span>,
           <span class="st">"#' y &lt;- my_function3 (x = datasets::iris)"</span>,
           <span class="st">"#' @export"</span>,
           <span class="st">"my_function3 &lt;- function (x) {"</span>,
           <span class="st">"  return (x)"</span>,
           <span class="st">"}"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span> <span class="op">(</span><span class="va">code</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span> <span class="op">(</span><span class="va">path</span>, <span class="st">"R"</span>, <span class="st">"myfn3.R"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">roxygen2</span><span class="fu">::</span><span class="fu"><a href="https://roxygen2.r-lib.org/reference/roxygenize.html" class="external-link">roxygenise</a></span> <span class="op">(</span><span class="va">path</span><span class="op">)</span> <span class="co"># need to update docs with seed param</span>
<span class="co">#&gt; ℹ Loading demo</span>
<span class="co">#&gt; Writing NAMESPACE</span>
<span class="co">#&gt; Writing NAMESPACE</span>
<span class="co">#&gt; Writing my_function3.Rd</span>
<span class="va">x7</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/autotest_package.html">autotest_package</a></span> <span class="op">(</span><span class="va">path</span>, test <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── autotesting demo ──</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ✔ [1 / 2]: my_function</span>
<span class="co">#&gt; ✔ [2 / 2]: my_function3</span>
<span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span> <span class="op">(</span><span class="va">x7</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span>dom <span class="op">=</span> <span class="st">"t"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-a1c9b28785710536a532" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a1c9b28785710536a532">{"x":{"filter":"none","data":[["1"],["warning"],["par_matches_docs"],["my_function3"],["x"],[null],["Check that documentation matches class of input parameter"],["Parameter documentation does not describe class of [data.frame]"],[true],["f9baf4e41d8b754a24055c64c41a8386"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>type<\/th>\n      <th>test_name<\/th>\n      <th>fn_name<\/th>\n      <th>parameter<\/th>\n      <th>parameter_type<\/th>\n      <th>operation<\/th>\n      <th>content<\/th>\n      <th>test<\/th>\n      <th>yaml_hash<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}]}},"evals":[],"jsHooks":[]}</script><p>This warning again indicates precisely how it can be rectified, for example by replacing the third line with</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">code</span> <span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"#' @param x An input which can be a data.frame"</span></code></pre></div>
</div>
</div>
<div id="general-procedure" class="section level2">
<h2 class="hasAnchor">
<a href="#general-procedure" class="anchor" aria-hidden="true"></a>General Procedure</h2>
<p>The demonstrations above hopefully suffice to indicate the general procedure which <code>autotest</code> attempts to make as simple as possible. This procedure consists of the following single point:</p>
<ul>
<li>From the moment you develop your first function, and every single time you modify your code, do whatever steps are necessary to ensure <code><a href="../reference/autotest_package.html">autotest_package()</a></code> returns <code>NULL</code>.</li>
</ul>
<p>This vignette has only demonstrated a few of the tests included in the package, but as long as you use <code>autotest</code> throughout the entire process of package development, any additional diagnostic messages should include sufficient information for you to be able to restructure your code to avoid them.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Mark Padgham.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link external-link">pkgdown</a> 1.6.1.9001.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
